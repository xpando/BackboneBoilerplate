(function(n,t){if(typeof exports=="object"){var i=require("underscore"),r=require("backbone");module.exports=t(i,r)}else typeof define=="function"&&define.amd&&define(["underscore","backbone"],t)})(this,function(n,t){"use strict";return t.Wreqr=function(n,t,i){var r={};return r.Handlers=function(n,t){var i=function(n){this.options=n;this._wreqrHandlers={};t.isFunction(this.initialize)&&this.initialize(n)};return i.extend=n.Model.extend,t.extend(i.prototype,n.Events,{setHandlers:function(n){t.each(n,function(n,i){var r=null;t.isObject(n)&&!t.isFunction(n)&&(r=n.context,n=n.callback);this.setHandler(i,n,r)},this)},setHandler:function(n,t,i){var r={callback:t,context:i};this._wreqrHandlers[n]=r;this.trigger("handler:add",n,t,i)},hasHandler:function(n){return!!this._wreqrHandlers[n]},getHandler:function(n){var t=this._wreqrHandlers[n];if(!t)throw new Error("Handler not found for '"+n+"'");return function(){var n=Array.prototype.slice.apply(arguments);return t.callback.apply(t.context,n)}},removeHandler:function(n){delete this._wreqrHandlers[n]},removeAllHandlers:function(){this._wreqrHandlers={}}}),i}(n,i),r.CommandStorage=function(){var t=function(n){this.options=n;this._commands={};i.isFunction(this.initialize)&&this.initialize(n)};return i.extend(t.prototype,n.Events,{getCommands:function(n){var t=this._commands[n];return t||(t={command:n,instances:[]},this._commands[n]=t),t},addCommand:function(n,t){var i=this.getCommands(n);i.instances.push(t)},clearCommands:function(n){var t=this.getCommands(n);t.instances=[]}}),t}(),r.Commands=function(n){return n.Handlers.extend({storageType:n.CommandStorage,constructor:function(t){this.options=t||{};this._initializeStorage(this.options);this.on("handler:add",this._executeCommands,this);var i=Array.prototype.slice.call(arguments);n.Handlers.prototype.constructor.apply(this,i)},execute:function(n,t){n=arguments[0];t=Array.prototype.slice.call(arguments,1);this.hasHandler(n)?this.getHandler(n).apply(this,t):this.storage.addCommand(n,t)},_executeCommands:function(n,t,r){var u=this.storage.getCommands(n);i.each(u.instances,function(n){t.apply(r,n)});this.storage.clearCommands(n)},_initializeStorage:function(n){var r,t=n.storageType||this.storageType;r=i.isFunction(t)?new t:t;this.storage=r}})}(r),r.RequestResponse=function(n){return n.Handlers.extend({request:function(){var n=arguments[0],t=Array.prototype.slice.call(arguments,1);return this.getHandler(n).apply(this,t)}})}(r),r.EventAggregator=function(n,t){var i=function(){};return i.extend=n.Model.extend,t.extend(i.prototype,n.Events),i}(n,i),r}(t,t.Marionette,n),t.Wreqr});
//# sourceMappingURL=backbone.wreqr.min.js.map